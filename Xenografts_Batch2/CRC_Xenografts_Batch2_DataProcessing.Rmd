---
title: "Setup - CRC Xenografts Batch 2"
author: Sophie Herbst
output:
  html_document:
    code_folding: hide
    toc: yes
    toc_depth: 4
    toc_float: yes
editor_options: 
  chunk_output_type: console
---
Analysis date: `r Sys.Date()`

CRC Xenografts # 1 and #14

# TODO
Individual sets: Do not normalise to bridge.

# Setup
## Load libraries and functions
```{r, echo=FALSE, warning=FALSE, message=FALSE}
set.seed(2022)
library(fgsea)
library(AnnotationDbi)
library(org.Hs.eg.db)
library(DEP)
library(SummarizedExperiment)
# library(pls)
library(mdatools)
source("../../../General/Code/Analysis_Functions.R")
```

## Load other data
### Reactome
```{r}
genesets.reactome = msigdbr::msigdbr(species = "Homo sapiens", category = "C2", subcategory = "CP:REACTOME")

REACTOME_SIGNALING_BY_ALK <- genesets.reactome %>% filter(gs_name == "REACTOME_SIGNALING_BY_ALK" ) %>% .$gene_symbol


REACTOME_PENTOSE_PHOSPHATE_PATHWAY <- genesets.reactome %>% filter(gs_name == "REACTOME_PENTOSE_PHOSPHATE_PATHWAY" ) %>% .$gene_symbol

rm(genesets.reactome)
```

### StringDB
```{r}
string_db <- STRINGdb::STRINGdb$new( version="11.5", species=9606,
 score_threshold=400, input_directory="../../../General/Code/Data/")
```

### PhosphositePlus Databases
```{r}
kinase_substrate_dataset <- read_delim("../../../General/Code/Data/Kinase_Substrate_Dataset", delim = "\t", skip = 2) %>% filter(KIN_ORGANISM == "human")
kinase_substrate_dataset
Phosphorylation_site_dataset <- read_delim("../../../General/Code/Data/Phosphorylation_site_dataset", delim = "\t", skip = 2) %>% 
  filter(ORGANISM == "human")
Regulatory_sites_dataset <- read_delim("../../../General/Code/Data/Regulatory_sites", delim = "\t", skip = 2) %>% 
  filter(ORGANISM == "human") %>%
  filter(str_detect( MOD_RSD, "p") )
```

### PKIDB
```{r, warning=FALSE}
pkidb <- readxl::read_excel("../../../General/Code/Data/PKIDB_20220718.xlsx")
pkidb <- pkidb %>% filter(!is.na(Targets) & Targets != "nan")
for(i in 1:nrow(pkidb) ){
  if(!is.na(pkidb[i, "INN_Name"] )){
    next
  }else{
    pkidb[i, "INN_Name"] <- pkidb[i-1, "INN_Name"]
    pkidb[i, "InChiKey"] <- pkidb[i-1, "InChiKey"]
    pkidb[i, "Canonical_Smiles"] <- pkidb[i-1, "Canonical_Smiles"]
  }
}
pkidb
```

## File paths
### Mass Spec data
```{r, warning=FALSE}
file_path_pST_Set1 <- "../Data/Mass_Spec/SH_20230712_CRC_Xenograft_Batch2_Set1_TMTPro_AC106_AA_pST_PSMs.txt"
file_path_pST_Set2 <- "../Data/Mass_Spec/SH_20230713_CRC_Xenografts_Batch2_Set2_TMTPro_AC103_AA_pST_PSMs.txt"
file_path_pST_Set3 <- "../Data/Mass_Spec/SH_20230727_CRC_Xenografts_Batch2_Set3_TMTPro_AC223_AA_pST_PSMs.txt"
file_path_pST_Set4 <- "../Data/Mass_Spec/SH_20230801_CRC_Xenografts_Batch2_Set4_TMTPro_AC225_AA_pST_fixedvaluePSMValidator_PSMs.txt"
file_path_pST_Set5 <- "../Data/Mass_Spec/SH_20230726_CRC_Xenografts_Batch2_Set5_TMTPro_AC221_AA_pST_PSMs.txt"

file_path_pY_Set1 <- "../Data/Mass_Spec/SH_20230712_CRC_Xenografts_Batch2_Set1_TMTPro_AC103_AA_pY_PSMs.txt"
#file_path_pY_Set2 <- "../Data/Mass_Spec/SH_20230"
file_path_pY_Set3 <- "../Data/Mass_Spec/SH_20230720_CRC_Xenografts_Batch2_Set3_TMTPro_AC119_AA_pY_fixedvaluePSMValidator_PSMs.txt"
file_path_pY_Set4 <- "../Data/Mass_Spec/SH_20230725_CRC_Xenografts_Batch2_Set4_TMTPro_AC221_AA_pY_PSMs.txt"
file_path_pY_Set5 <- "../Data/Mass_Spec/SH_20230801_CRC_Xenografts_Batch2_Set5rep_TMTPro_AC112_AA_pY_PSMs.txt"

file_path_sup_Set1 <- "../Data/Mass_Spec/SH_20230712_CRC_Xenografts_Batch2_Set1_TMTpro_usedpre+AC87_HR1_sup-(1)_PSMs.txt"
file_path_sup_Set2 <- "../Data/Mass_Spec/SH_20230713_CRC_Xenografts_Batch2_Set2_TMTpro_usedpre+AC101_HR1_sup-(3)_PSMs.txt"
file_path_sup_Set3 <- "../Data/Mass_Spec/SH_20230720_CRC_Xenografts_Batch2_Set3_TMTpro_newpre+AC118_HR1_sup-(1)_PSMs.txt"
file_path_sup_Set4 <- "../Data/Mass_Spec/SH_20230726_CRC_Xenografts_Batch2_Set4_TMTpro_usedpre+AC222_HR1_sup_PSMs.txt"
file_path_sup_Set5pST <- "../Data/Mass_Spec/SH_20230726_CRC_Xenografts_Batch2_Set5_TMTpro_usedpre+AC222_HR1_sup_PSMs.txt"
file_path_sup_Set5pY <- "../Data/Mass_Spec/SH_20230801_CRC_Xenografts_Batch2_Set5rep_TMTpro_usedpre+AC75_HR1_sup_PSMs.txt"

```



## Process data
### pY
```{r, message=TRUE, warning=FALSE}
# Set 1
pY_Set1 <- Filter_And_Average_PSMs(file_path_phos = file_path_pY_Set1,  
                                   #perculator_qvalue = FALSE,
                              file_path_sup = file_path_sup_Set1,
                              return_data = "phos", 
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c( "126", "127N", "127C", "128N", "128C", "129N") )  %>%
                              #norm_channel = "126") %>%
    filter(grepl("y", `Annotated Sequence` ) )

# Set 3
pY_Set3 <- Filter_And_Average_PSMs(file_path_phos = file_path_pY_Set3,  
                              file_path_sup = file_path_sup_Set3,
                              return_data = "phos", 
                              perculator_qvalue = FALSE,
                              ptmRS_score_filter = FALSE,
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c("126", "127N", "127C", "128N", "128C" ) )  %>%
                              #norm_channel = "127C") %>%
    filter(grepl("y", `Annotated Sequence` ) )

# Set 4
pY_Set4 <- Filter_And_Average_PSMs(file_path_phos = file_path_pY_Set4,  
                              file_path_sup = file_path_sup_Set4,
                              return_data = "phos", 
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c("126", "127N", "127C", "128N" ) )  %>%
                              #norm_channel = "126") %>%
    filter(grepl("y", `Annotated Sequence` ) )

# Set 5
pY_Set5_normXenograft1 <- Filter_And_Average_PSMs(file_path_phos = file_path_pY_Set5,  
                              file_path_sup = file_path_sup_Set5pY,
                              return_data = "phos", 
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c("131N", "131C", "132N" ) )  %>%
                              #norm_channel = "131N") %>%
    filter(grepl("y", `Annotated Sequence` ) )

# Set 5
pY_Set5_normXenograft14 <- Filter_And_Average_PSMs(file_path_phos = file_path_pY_Set5,  
                              file_path_sup = file_path_sup_Set5pY,
                              return_data = "phos", 
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c("134N", "134C", "135N" ) )  %>%
                              #norm_channel = "134N") %>%
    filter(grepl("y", `Annotated Sequence` ) )
```

### pST
```{r, message=TRUE, warning=FALSE}
# Set 1
pST_Set1 <- Filter_And_Average_PSMs(file_path_phos = file_path_pST_Set1,  
                              file_path_sup = file_path_sup_Set1,
                              return_data = "phos", 
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c( "126", "127N", "127C", "128N", "128C", "129N") )  %>%
                              #norm_channel = "126") %>%
    filter(grepl("s|t", `Annotated Sequence` ) )

# Set 2
pST_Set2 <- Filter_And_Average_PSMs(file_path_phos = file_path_pST_Set2,  
                              file_path_sup = file_path_sup_Set2,
                              return_data = "phos", 
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c( "126", "127N", "127C", "128N", "128C") )  %>%
                              #norm_channel = "128N") %>%
    filter(grepl("s|t", `Annotated Sequence` ) )

# Set 3
pST_Set3 <- Filter_And_Average_PSMs(file_path_phos = file_path_pST_Set3,  
                              file_path_sup = file_path_sup_Set3,
                              return_data = "phos", 
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c("126", "127N", "127C", "128N", "128C" ) )  %>%
                              #norm_channel = "127C") %>%
    filter(grepl("s|t", `Annotated Sequence` ) )

# Set 4
pST_Set4 <- Filter_And_Average_PSMs(file_path_phos = file_path_pST_Set4,  
                              file_path_sup = file_path_sup_Set4,
                              return_data = "phos", 
                              perculator_qvalue = FALSE,
                              ptmRS_score_filter = FALSE,
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c("126", "127N", "127C", "128N" ) )  %>%
                              #norm_channel = "126") %>%
    filter(grepl("s|t", `Annotated Sequence` ) )

# Set 5
pST_Set5_normXenograft1 <- Filter_And_Average_PSMs(file_path_phos = file_path_pST_Set5,  
                              file_path_sup = file_path_sup_Set5pST,
                              return_data = "phos", 
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c("129N", "129C", "130N" ) )  %>%
                              #norm_channel = "129N") %>%
    filter(grepl("s|t", `Annotated Sequence` ) )

# Set 5
pST_Set5_normXenograft14 <- Filter_And_Average_PSMs(file_path_phos = file_path_pST_Set5,  
                              file_path_sup = file_path_sup_Set5pST,
                              return_data = "phos", 
                              NA_replace = FALSE, NA_peptide_cutoff = 0,
                              ion_score_filter = 20, 
                              NA_cutoff_channel = 0.4,
                              norm_channel = c("132N", "132C", "133N" ) )  %>%
                              #norm_channel = "132N") %>%
    filter(grepl("s|t", `Annotated Sequence` ) )
```




## Format data
### Annotation
#### Samples
```{r}
name_l_Set1 = list( "126" = "Xenograft1_ctrl_5d_1_Set1", # this one
               "127N" = "Xenograft1_ctrl_5d_2_Set1", 
               "127C" = "Xenograft1_ctrl_5d_3_Set1", 
               "128N"	= "Xenograft1_ctrl_5d_4_Set1", 
               "128C"	 = "Xenograft1_ctrl_5d_5_Set1", 
               "129N"	= "Xenograft1_ctrl_5d_7_Set1", 
               "129C"	= "Xenograft1_E_24h_1_Set1", 
               "130N"	= "Xenograft1_E_24h_2_Set1", 
               "130C"	= "Xenograft1_E_24h_3_Set1", 
               "131N"	= "Xenograft1_E_24h_4_Set1", 
               "131C"	= "Xenograft1_EC_24h_1_Set1", 
               "132N"	= "Xenograft1_EC_24h_2_Set1", 
               "132C"	= "Xenograft1_EC_24h_3_Set1", 
               "133N"	= "Xenograft1_EC_24h_4_Set1", 
               "133C"	= "Xenograft1_EBC_24h_1_Set1", 
               "134N"=  "Xenograft1_EBC_24h_2_Set1", 
               "134C"	= "Xenograft1_EBC_24h_3_Set1", 
               "135N"	= "Xenograft1_EBC_24h_4_Set1"
)

name_l_Set2 = list( "126" = "Xenograft1_ctrl_5d_6_Set2", 
               "127N" = "Xenograft1_ctrl_5d_7_Set2", 
               "127C" = "Xenograft1_ctrl_5d_8_Set2", 
               "128N"	= "Xenograft1_ctrl_5d_1_Set2", # this one
               "128C"	= "Xenograft1_ctrl_5d_5_Set2", 
               "129N"	= "Xenograft1_E_5d_1_Set2", 
               "129C"	= "Xenograft1_E_5d_2_Set2", 
               "130N"	= "Xenograft1_E_5d_3_Set2", 
               "130C"	= "Xenograft1_E_5d_4_Set2", 
               "131N"	= "Xenograft1_EC_5d_1_Set2", 
               "131C"	= "Xenograft1_EC_5d_2_Set2", 
               "132N"	= "Xenograft1_EC_5d_3_Set2", 
               "132C"	= "Xenograft1_EC_5d_4_Set2", 
               "133N"	= "Xenograft1_EC_5d_5_Set2", 
               "133C"	= "Xenograft1_EBC_5d_1_Set2", 
               "134N"=  "Xenograft1_EBC_5d_2_Set2", 
               "134C"	= "Xenograft1_EBC_5d_3_Set2", 
               "135N"	= "Xenograft1_EBC_5d_4_Set2"
)

name_l_Set3 = list( "126" = "Xenograft14_ctrl_5d_1_Set3", 
               "127N" = "Xenograft14_ctrl_5d_2_Set3", 
               "127C" = "Xenograft14_ctrl_5d_3_Set3", # this one
               "128N"	= "Xenograft14_ctrl_5d_5_Set3", 
               "128C"	= "Xenograft14_ctrl_5d_6_Set3", 
               "129N"	= "Xenograft14_E_24h_1_Set3", 
               "129C"	= "Xenograft14_E_24h_2_Set3", 
               "130N"	= "Xenograft14_E_24h_3_Set3", 
               "130C"	= "Xenograft14_E_24h_4_Set3", 
               "131N"	= "Xenograft14_EC_24h_1_Set3", 
               "131C"	= "Xenograft14_EC_24h_2_Set3", 
               "132N"	= "Xenograft14_EC_24h_3_Set3", 
               "132C"	= "Xenograft14_EC_24h_4_Set3", 
               "133N"	= "Xenograft14_EC_24h_5_Set3", 
               "133C"	= "Xenograft14_EBC_24h_1_Set3", 
               "134N"=  "Xenograft14_EBC_24h_2_Set3", 
               "134C"	= "Xenograft14_EBC_24h_3_Set3", 
               "135N"	= "Xenograft14_EBC_24h_4_Set3"
)

name_l_Set4 = list( "126" = "Xenograft14_ctrl_5d_3_Set4", # this one
               "127N" = "Xenograft14_ctrl_5d_4_Set4", 
               "127C" = "Xenograft14_ctrl_5d_5_Set4", 
               "128N"	= "Xenograft14_ctrl_5d_6_Set4", 
               "128C"	= "Xenograft14_E_5d_1_Set4", 
               "129N"	= "Xenograft14_E_5d_2_Set4", 
               "129C"	= "Xenograft14_E_5d_3_Set4", 
               "130N"	= "Xenograft14_E_5d_4_Set4", 
               "130C"	= "Xenograft14_E_5d_5_Set4", 
               "131N"	= "Xenograft14_EC_5d_1_Set4", 
               "131C"	= "Xenograft14_EC_5d_2_Set4", 
               "132N"	= "Xenograft14_EC_5d_3_Set4", 
               "132C"	= "Xenograft14_EC_5d_4_Set4", 
               "133N"	= "Xenograft14_EC_5d_5_Set4", 
               "133C"	= "Xenograft14_EBC_5d_1_Set4", 
               "134N"=  "Xenograft14_EBC_5d_2_Set4", 
               "134C"	= "Xenograft14_EBC_5d_3_Set4", 
               "135N"	= "Xenograft14_EBC_5d_4_Set4"
)

name_l_Set5pY_normXenograft1 = list( 
               "128C"	= "Xenograft1_E_24h_5_Set5", 
               "129N"	= "Xenograft1_E_5d_5_Set5", 
               "129C"	= "Xenograft1_EC_24h_5_Set5", 
               "130N"	= "Xenograft1_EBC_24h_5_Set5", 
               "130C"	= "Xenograft1_EBC_5d_5_Set5", 
               "131N"	= "Xenograft1_ctrl_5d_1_Set5", # this one
               "131C"	= "Xenograft1_ctrl_5d_5_Set5", 
               "132N"	= "Xenograft1_ctrl_5d_7_Set5", 
               "132C"	= "Xenograft14_E_24h_5_Set5", 
               "133N"	= "Xenograft14_EBC_24h_5_Set5", 
               "133C"	= "Xenograft14_EBC_5d_5_Set5", 
               "134N"=  "Xenograft14_ctrl_5d_3_Set5", 
               "134C"	= "Xenograft14_ctrl_5d_5_Set5", 
               "135N"	= "Xenograft14_ctrl_5d_6_Set5"
)

name_l_Set5pY_normXenograft14 = list( 
               "128C"	= "Xenograft1_E_24h_5_Set5", 
               "129N"	= "Xenograft1_E_5d_5_Set5", 
               "129C"	= "Xenograft1_EC_24h_5_Set5", 
               "130N"	= "Xenograft1_EBC_24h_5_Set5", 
               "130C"	= "Xenograft1_EBC_5d_5_Set5", 
               "131N"	= "Xenograft1_ctrl_5d_1_Set5", 
               "131C"	= "Xenograft1_ctrl_5d_5_Set5", 
               "132N"	= "Xenograft1_ctrl_5d_7_Set5", 
               "132C"	= "Xenograft14_E_24h_5_Set5", 
               "133N"	= "Xenograft14_EBC_24h_5_Set5", 
               "133C"	= "Xenograft14_EBC_5d_5_Set5", 
               "134N"=  "Xenograft14_ctrl_5d_3_Set5", # this one
               "134C"	= "Xenograft14_ctrl_5d_5_Set5", 
               "135N"	= "Xenograft14_ctrl_5d_6_Set5"
)

name_l_Set5pST_normXenograft1 = list( "126" = "Xenograft1_E_24h_5_Set5", 
               "127N" = "Xenograft1_E_5d_5_Set5", 
               "127C" = "Xenograft1_EC_24h_5_Set5", 
               "128N"	= "Xenograft1_EBC_24h_5_Set5", 
               "128C"	= "Xenograft1_EBC_5d_5_Set5", 
               "129N"	= "Xenograft1_ctrl_5d_1_Set5", # this one
               "129C"	= "Xenograft1_ctrl_5d_5_Set5", 
               "130N"	= "Xenograft1_ctrl_5d_7_Set5", 
               "130C"	= "Xenograft14_E_24h_5_Set5", 
               "131N"	= "Xenograft14_EBC_24h_5_Set5", 
               "131C"	= "Xenograft14_EBC_5d_5_Set5", 
               "132N"	= "Xenograft14_ctrl_5d_3_Set5", 
               "132C"	= "Xenograft14_ctrl_5d_5_Set5", 
               "133N"	= "Xenograft14_ctrl_5d_6_Set5"
)

name_l_Set5pST_normXenograft14 = list( "126" = "Xenograft1_E_24h_5_Set5", 
               "127N" = "Xenograft1_E_5d_5_Set5", 
               "127C" = "Xenograft1_EC_24h_5_Set5", 
               "128N"	= "Xenograft1_EBC_24h_5_Set5", 
               "128C"	= "Xenograft1_EBC_5d_5_Set5", 
               "129N"	= "Xenograft1_ctrl_5d_1_Set5", 
               "129C"	= "Xenograft1_ctrl_5d_5_Set5", 
               "130N"	= "Xenograft1_ctrl_5d_7_Set5", 
               "130C"	= "Xenograft14_E_24h_5_Set5", 
               "131N"	= "Xenograft14_EBC_24h_5_Set5", 
               "131C"	= "Xenograft14_EBC_5d_5_Set5", 
               "132N"	= "Xenograft14_ctrl_5d_3_Set5", # this one
               "132C"	= "Xenograft14_ctrl_5d_5_Set5", 
               "133N"	= "Xenograft14_ctrl_5d_6_Set5"
)


```

### Individual sets
#### pY
```{r}
pY_Set1_form <- pY_Set1 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pY_Set1 <- c(name_l_Set1, paste0("log2FC_", name_l_Set1 ), name_l_Set1 )
names(newnames_pY_Set1) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set1)), 
                          paste0("log2FC_", names(name_l_Set1)),
                          paste0("Centered_Abundance ", names(name_l_Set1)))
stopifnot(colnames(pY_Set1_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pY_Set1)) 
newnames_pY_Set1["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pY_Set1["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pY_Set1["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pY_Set1["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pY_Set1_form) <- newnames_pY_Set1[colnames(pY_Set1_form)]
mean_normal_pY_Set1 <- pY_Set1_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pY_Set1_form <- pY_Set1_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pY_Set1 } ) 
pY_Set1_form 

#pY_Set2_form <- pY_Set2 %>%
#  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), #Master.Protein.Accessions = `Master Protein Accessions`,
#                             Master.Protein.Descriptions = `Master Protein #Descriptions`)
#newnames_pY_Set2 <- c(name_l_Set2, paste0("log2FC_", name_l_Set2 ), #name_l_Set2 )
#names(newnames_pY_Set2) <- c( paste0("TMTNorm_Abundance ", #names(name_l_Set2)), 
#                          paste0("log2FC_", names(name_l_Set2)),
#                          paste0("Centered_Abundance ", #names(name_l_Set2)))
#stopifnot(colnames(pY_Set2_form %>% 
#                         select(contains("TMTNorm_Abundance" ) | #contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  #names(newnames_pY_Set2)) 
#newnames_pY_Set2["HGNC_Symbol"] <- "HGNC_Symbol"
#newnames_pY_Set2["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
#newnames_pY_Set2["Master.Protein.Descriptions"] <- #"Master.Protein.Descriptions"
#newnames_pY_Set2["Annotated Sequence"] <- "Annotated_Sequence"
#colnames(pY_Set2_form) <- newnames_pY_Set2[colnames(pY_Set2_form)]
#mean_normal_pY_Set2 <- pY_Set2_form %>% select(contains("_ctrl" )) %>%
#  #2^. %>% 
#  rowMeans()
#pY_Set2_form <- pY_Set2_form %>%
#  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pY_Set2 #} ) 
#pY_Set2_form

pY_Set3_form <- pY_Set3 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pY_Set3 <- c(name_l_Set3, paste0("log2FC_", name_l_Set3 ), name_l_Set3 )
names(newnames_pY_Set3) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set3)), 
                          paste0("log2FC_", names(name_l_Set3)),
                          paste0("Centered_Abundance ", names(name_l_Set3)))
stopifnot(colnames(pY_Set3_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pY_Set3)) 
newnames_pY_Set3["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pY_Set3["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pY_Set3["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pY_Set3["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pY_Set3_form) <- newnames_pY_Set3[colnames(pY_Set3_form)]
mean_normal_pY_Set3 <- pY_Set3_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pY_Set3_form <- pY_Set3_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pY_Set3 } ) 
pY_Set3_form


pY_Set4_form <- pY_Set4 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pY_Set4 <- c(name_l_Set4, paste0("log2FC_", name_l_Set4 ), name_l_Set4 )
names(newnames_pY_Set4) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set4)), 
                          paste0("log2FC_", names(name_l_Set4)),
                          paste0("Centered_Abundance ", names(name_l_Set4)))
stopifnot(colnames(pY_Set4_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pY_Set4)) 
newnames_pY_Set4["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pY_Set4["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pY_Set4["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pY_Set4["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pY_Set4_form) <- newnames_pY_Set4[colnames(pY_Set4_form)]
mean_normal_pY_Set4 <- pY_Set4_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pY_Set4_form <- pY_Set4_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pY_Set4 } ) 
pY_Set4_form

pY_Set5_normXenograft1_form <- pY_Set5_normXenograft1 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pY_Set5_normXenograft1 <- c(name_l_Set5pY_normXenograft1, paste0("log2FC_", name_l_Set5pY_normXenograft1 ), name_l_Set5pY_normXenograft1 )
names(newnames_pY_Set5_normXenograft1) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set5pY_normXenograft1)), 
                          paste0("log2FC_", names(name_l_Set5pY_normXenograft1)),
                          paste0("Centered_Abundance ", names(name_l_Set5pY_normXenograft1)))
stopifnot(colnames(pY_Set5_normXenograft1_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pY_Set5_normXenograft1)) 
newnames_pY_Set5_normXenograft1["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pY_Set5_normXenograft1["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pY_Set5_normXenograft1["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pY_Set5_normXenograft1["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pY_Set5_normXenograft1_form) <- newnames_pY_Set5_normXenograft1[colnames(pY_Set5_normXenograft1_form)]
mean_normal_pY_Set5_normXenograft1 <- pY_Set5_normXenograft1_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pY_Set5_normXenograft1_form <- pY_Set5_normXenograft1_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pY_Set5_normXenograft1 } ) 
pY_Set5_normXenograft1_form

pY_Set5_normXenograft14_form <- pY_Set5_normXenograft14 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pY_Set5_normXenograft14 <- c(name_l_Set5pY_normXenograft14, paste0("log2FC_", name_l_Set5pY_normXenograft14 ), name_l_Set5pY_normXenograft14 )
names(newnames_pY_Set5_normXenograft14) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set5pY_normXenograft14)), 
                          paste0("log2FC_", names(name_l_Set5pY_normXenograft14)),
                          paste0("Centered_Abundance ", names(name_l_Set5pY_normXenograft14)))
stopifnot(colnames(pY_Set5_normXenograft14_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pY_Set5_normXenograft14)) 
newnames_pY_Set5_normXenograft14["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pY_Set5_normXenograft14["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pY_Set5_normXenograft14["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pY_Set5_normXenograft14["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pY_Set5_normXenograft14_form) <- newnames_pY_Set5_normXenograft14[colnames(pY_Set5_normXenograft14_form)]
mean_normal_pY_Set5_normXenograft14 <- pY_Set5_normXenograft14_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pY_Set5_normXenograft14_form <- pY_Set5_normXenograft14_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pY_Set5_normXenograft14 } ) 
pY_Set5_normXenograft14_form
```

#### pST
```{r}
pST_Set1_form <- pST_Set1 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pST_Set1 <- c(name_l_Set1, paste0("log2FC_", name_l_Set1 ), name_l_Set1 )
names(newnames_pST_Set1) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set1)), 
                          paste0("log2FC_", names(name_l_Set1)),
                          paste0("Centered_Abundance ", names(name_l_Set1)))
stopifnot(colnames(pST_Set1_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pST_Set1)) 
newnames_pST_Set1["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pST_Set1["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pST_Set1["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pST_Set1["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pST_Set1_form) <- newnames_pST_Set1[colnames(pST_Set1_form)]
mean_normal_pST_Set1 <- pST_Set1_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pST_Set1_form <- pST_Set1_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pST_Set1 } ) 
pST_Set1_form 

pST_Set2_form <- pST_Set2 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pST_Set2 <- c(name_l_Set2, paste0("log2FC_", name_l_Set2 ), name_l_Set2 )
names(newnames_pST_Set2) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set2)), 
                          paste0("log2FC_", names(name_l_Set2)),
                          paste0("Centered_Abundance ", names(name_l_Set2)))
stopifnot(colnames(pST_Set2_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pST_Set2)) 
newnames_pST_Set2["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pST_Set2["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pST_Set2["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pST_Set2["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pST_Set2_form) <- newnames_pST_Set2[colnames(pST_Set2_form)]
mean_normal_pST_Set2 <- pST_Set2_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pST_Set2_form <- pST_Set2_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pST_Set2 } ) 
pST_Set2_form

pST_Set3_form <- pST_Set3 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pST_Set3 <- c(name_l_Set3, paste0("log2FC_", name_l_Set3 ), name_l_Set3 )
names(newnames_pST_Set3) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set3)), 
                          paste0("log2FC_", names(name_l_Set3)),
                          paste0("Centered_Abundance ", names(name_l_Set3)))
stopifnot(colnames(pST_Set3_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pST_Set3)) 
newnames_pST_Set3["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pST_Set3["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pST_Set3["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pST_Set3["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pST_Set3_form) <- newnames_pST_Set3[colnames(pST_Set3_form)]
mean_normal_pST_Set3 <- pST_Set3_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pST_Set3_form <- pST_Set3_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pST_Set3 } ) 
pST_Set3_form


pST_Set4_form <- pST_Set4 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pST_Set4 <- c(name_l_Set4, paste0("log2FC_", name_l_Set4 ), name_l_Set4 )
names(newnames_pST_Set4) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set4)), 
                          paste0("log2FC_", names(name_l_Set4)),
                          paste0("Centered_Abundance ", names(name_l_Set4)))
stopifnot(colnames(pST_Set4_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pST_Set4)) 
newnames_pST_Set4["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pST_Set4["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pST_Set4["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pST_Set4["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pST_Set4_form) <- newnames_pST_Set4[colnames(pST_Set4_form)]
mean_normal_pST_Set4 <- pST_Set4_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pST_Set4_form <- pST_Set4_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pST_Set4 } ) 
pST_Set4_form

pST_Set5_normXenograft1_form <- pST_Set5_normXenograft1 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pST_Set5_normXenograft1 <- c(name_l_Set5pST_normXenograft1, paste0("log2FC_", name_l_Set5pST_normXenograft1 ), name_l_Set5pST_normXenograft1 )
names(newnames_pST_Set5_normXenograft1) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set5pST_normXenograft1)), 
                          paste0("log2FC_", names(name_l_Set5pST_normXenograft1)),
                          paste0("Centered_Abundance ", names(name_l_Set5pST_normXenograft1)))
stopifnot(colnames(pST_Set5_normXenograft1_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pST_Set5_normXenograft1)) 
newnames_pST_Set5_normXenograft1["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pST_Set5_normXenograft1["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pST_Set5_normXenograft1["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pST_Set5_normXenograft1["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pST_Set5_normXenograft1_form) <- newnames_pST_Set5_normXenograft1[colnames(pST_Set5_normXenograft1_form)]
mean_normal_pST_Set5_normXenograft1 <- pST_Set5_normXenograft1_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pST_Set5_normXenograft1_form <- pST_Set5_normXenograft1_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pST_Set5_normXenograft1 } ) 
pST_Set5_normXenograft1_form

pST_Set5_normXenograft14_form <- pST_Set5_normXenograft14 %>%
  select(`Annotated Sequence`, HGNC_Symbol, contains("log2FC"), Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`)
newnames_pST_Set5_normXenograft14 <- c(name_l_Set5pST_normXenograft14, paste0("log2FC_", name_l_Set5pST_normXenograft14 ), name_l_Set5pST_normXenograft14 )
names(newnames_pST_Set5_normXenograft14) <- c( paste0("TMTNorm_Abundance ", names(name_l_Set5pST_normXenograft14)), 
                          paste0("log2FC_", names(name_l_Set5pST_normXenograft14)),
                          paste0("Centered_Abundance ", names(name_l_Set5pST_normXenograft14)))
stopifnot(colnames(pST_Set5_normXenograft14_form %>% 
                         select(contains("TMTNorm_Abundance" ) | contains("log2FC" ) | contains("Centered_Abundance ") ) ) %in%  names(newnames_pST_Set5_normXenograft14)) 
newnames_pST_Set5_normXenograft14["HGNC_Symbol"] <- "HGNC_Symbol"
newnames_pST_Set5_normXenograft14["Master.Protein.Accessions"] <- "Master.Protein.Accessions"
newnames_pST_Set5_normXenograft14["Master.Protein.Descriptions"] <- "Master.Protein.Descriptions"
newnames_pST_Set5_normXenograft14["Annotated Sequence"] <- "Annotated_Sequence"
colnames(pST_Set5_normXenograft14_form) <- newnames_pST_Set5_normXenograft14[colnames(pST_Set5_normXenograft14_form)]
mean_normal_pST_Set5_normXenograft14 <- pST_Set5_normXenograft14_form %>% select(contains("_ctrl" )) %>%
  #2^. %>% 
  rowMeans()
pST_Set5_normXenograft14_form <- pST_Set5_normXenograft14_form %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pST_Set5_normXenograft14 } ) 
pST_Set5_normXenograft14_form
```



### Combine the sets
#### pY
##### Xenografts # 1
```{r}
# Combine fold changes over bridge for the pY sets
pY_Xenograft1 <- left_join( 
  Minimize_df(pY_Set1, name_l = name_l_Set1, FC = TRUE),
  Minimize_df(pY_Set5_normXenograft1, name_l = name_l_Set5pY_normXenograft1, FC = TRUE),
  by = c("HGNC_Symbol", "Annotated_Sequence" ) )

pY_Xenograft1 <- left_join(pY_Xenograft1,
          pY_Set1 %>% 
            select(`Annotated Sequence`,  Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`),
          by= c("Annotated_Sequence"= "Annotated Sequence"))

pY_Xenograft1_noNApeptides <- pY_Xenograft1  %>% 
  select(-HGNC_Symbol, -Annotated_Sequence, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  is.na() %>%
  rowSums() <= 0
pY_Xenograft1_noNA <- pY_Xenograft1[pY_Xenograft1_noNApeptides,]

mean_normal_pY_Xenograft1 <- pY_Xenograft1_noNA %>% select(contains("log2FC_Xenograft1_ctrl" )) %>%
  #2^. %>% 
  rowMeans()

pY_Xenograft1_noNA <- pY_Xenograft1_noNA %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pY_Xenograft1 } ) 
 
pY_Xenograft1_noNA 
```

##### Xenografts # 14
```{r}
# Combine fold changes over bridge for the pY sets
pY_Xenograft14 <- 
  left_join(
  left_join( 
    Minimize_df(pY_Set3, name_l = name_l_Set3, FC = TRUE),
    Minimize_df(pY_Set4, name_l = name_l_Set4, FC = TRUE),
    by = c("HGNC_Symbol", "Annotated_Sequence" ) ),
  Minimize_df(pY_Set5_normXenograft14, name_l = name_l_Set5pY_normXenograft14, FC = TRUE),
  by = c("HGNC_Symbol", "Annotated_Sequence" ) )

pY_Xenograft14 <- left_join(pY_Xenograft14,
          pY_Set3 %>% 
            select(`Annotated Sequence`,  Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`),
          by= c("Annotated_Sequence"= "Annotated Sequence"))

pY_Xenograft14_noNApeptides <- pY_Xenograft14  %>% 
  select(-HGNC_Symbol, -Annotated_Sequence, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  is.na() %>%
  rowSums() <= 0
pY_Xenograft14_noNA <- pY_Xenograft14[pY_Xenograft14_noNApeptides,]

mean_normal_pY_Xenograft14 <- pY_Xenograft14_noNA %>% select(contains("log2FC_Xenograft14_ctrl" )) %>%
  #2^. %>% 
  rowMeans()

pY_Xenograft14_noNA <- pY_Xenograft14_noNA %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pY_Xenograft14 } ) 
 
pY_Xenograft14_noNA 
```

#### pST
##### Xenografts # 1
```{r}
# Combine fold changes over bridge for the pST sets
pST_Xenograft1 <- left_join( 
  Minimize_df(pST_Set1, name_l = name_l_Set1, FC = TRUE),
  Minimize_df(pST_Set5_normXenograft1, name_l = name_l_Set5pST_normXenograft1, FC = TRUE),
  by = c("HGNC_Symbol", "Annotated_Sequence" ) )

pST_Xenograft1 <- left_join(pST_Xenograft1,
          pST_Set1 %>% 
            select(`Annotated Sequence`,  Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`),
          by= c("Annotated_Sequence"= "Annotated Sequence"))

pST_Xenograft1_noNApeptides <- pST_Xenograft1  %>% 
  select(-HGNC_Symbol, -Annotated_Sequence, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  is.na() %>%
  rowSums() <= 0
pST_Xenograft1_noNA <- pST_Xenograft1[pST_Xenograft1_noNApeptides,]

mean_normal_pST_Xenograft1 <- pST_Xenograft1_noNA %>% select(contains("log2FC_Xenograft1_ctrl" )) %>%
  #2^. %>% 
  rowMeans()

pST_Xenograft1_noNA <- pST_Xenograft1_noNA %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pST_Xenograft1 } ) 
 
pST_Xenograft1_noNA 
```

##### Xenografts # 14
```{r}
# Combine fold changes over bridge for the pST sets
pST_Xenograft14 <- 
  left_join(
  left_join( 
    Minimize_df(pST_Set3, name_l = name_l_Set3, FC = TRUE),
    Minimize_df(pST_Set4, name_l = name_l_Set4, FC = TRUE),
    by = c("HGNC_Symbol", "Annotated_Sequence" ) ),
  Minimize_df(pST_Set5_normXenograft14, name_l = name_l_Set5pST_normXenograft14, FC = TRUE),
  by = c("HGNC_Symbol", "Annotated_Sequence" ) )

pST_Xenograft14 <- left_join(pST_Xenograft14,
          pST_Set3 %>% 
            select(`Annotated Sequence`,  Master.Protein.Accessions = `Master Protein Accessions`,
                             Master.Protein.Descriptions = `Master Protein Descriptions`),
          by= c("Annotated_Sequence"= "Annotated Sequence"))

pST_Xenograft14_noNApeptides <- pST_Xenograft14  %>% 
  select(-HGNC_Symbol, -Annotated_Sequence, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  is.na() %>%
  rowSums() <= 0
pST_Xenograft14_noNA <- pST_Xenograft14[pST_Xenograft14_noNApeptides,]

mean_normal_pST_Xenograft14 <- pST_Xenograft14_noNA %>% select(contains("log2FC_Xenograft14_ctrl" )) %>%
  #2^. %>% 
  rowMeans()

pST_Xenograft14_noNA <- pST_Xenograft14_noNA %>%
  mutate_at( vars(contains("log2") ), function(f){ f - mean_normal_pST_Xenograft14 } ) 
 
pST_Xenograft14_noNA 
```



### Annotate phosphorylation sites
#### pY
```{r}
# TODO How to deal with peptides which have multiple phosphorylations?

all_pY_sites <- bind_rows(
  pY_Set1_form %>% select(HGNC_Symbol, Annotated_Sequence),
  #pY_Set2_form %>% select(HGNC_Symbol, Annotated_Sequence),
  pY_Set3_form %>% select(HGNC_Symbol, Annotated_Sequence),
  pY_Set4_form %>% select(HGNC_Symbol, Annotated_Sequence),
  pY_Set5_normXenograft1_form %>% select(HGNC_Symbol, Annotated_Sequence)) %>% unique
if(!all(str_count(all_pY_sites$Annotated_Sequence, "y") == 1)){warning("There are peptides with multiple pY sites")}
tmp_sequence <- paste0("jjjjjjj", all_pY_sites$Annotated_Sequence,"jjjjjjj" )
position_pY_phos <- str_locate(tmp_sequence, "y")[,1]
tmp_sequence <- str_sub(tmp_sequence, (position_pY_phos-7), position_pY_phos + 7)
tmp_sequence <- paste0( str_to_upper(str_sub(tmp_sequence,1,7 )), 
                                  str_to_lower(str_sub(tmp_sequence,8,8 )),
                                  str_to_upper(str_sub(tmp_sequence,9,15 )))
tmp_sequence <- str_replace_all(string = tmp_sequence, pattern ="J", replacement = "")
all_pY_sites$Modified_Sequence <- tmp_sequence
Phosphorylation_site_dataset_pY <- 
  Phosphorylation_site_dataset %>% filter(GENE %in% all_pY_sites$HGNC_Symbol) %>%
  filter(!str_detect(PROTEIN, "iso")) %>%
  filter( str_detect( `SITE_+/-7_AA`, "y" ) ) %>% 
  mutate(Modified_Sequence = paste0( str_to_upper(str_sub(`SITE_+/-7_AA`,1,7 )), 
                                  str_to_lower(str_sub(`SITE_+/-7_AA`,8,8 )),
                                  str_to_upper(str_sub(`SITE_+/-7_AA`,9,16 ))) ) %>% 
  select(GENE, PROTEIN, HU_CHR_LOC, MOD_RSD, SITE_GRP_ID, DOMAIN, Modified_Sequence) %>%
  unique()

Return_MOD_RSD <- function(HGNC_Symbol, Modified_Sequence){
  selprot <- Phosphorylation_site_dataset_pY %>% filter(GENE == HGNC_Symbol)
  if(length(str_which(selprot$Modified_Sequence, Modified_Sequence))==1){
  selsite <- selprot[ str_which(selprot$Modified_Sequence, Modified_Sequence), ]
  return(selsite$MOD_RSD)}else{return("NA")}
}

Return_DOMAIN <- function(HGNC_Symbol, Modified_Sequence){
  selprot <- Phosphorylation_site_dataset_pY %>% filter(GENE == HGNC_Symbol)
  if(length(str_which(selprot$Modified_Sequence, Modified_Sequence))==1){
  selsite <- selprot[ str_which(selprot$Modified_Sequence, Modified_Sequence), ]
  return(selsite$DOMAIN)}else{return("NA")}
}

Return_SITE_GRP_ID <- function(HGNC_Symbol, Modified_Sequence){
  selprot <- Phosphorylation_site_dataset_pY %>% filter(GENE == HGNC_Symbol)
  if(length(str_which(selprot$Modified_Sequence, Modified_Sequence))==1){
  selsite <- selprot[ str_which(selprot$Modified_Sequence, Modified_Sequence), ]
  return(selsite$SITE_GRP_ID)}else{return("NA")}
}

all_pY_sites$DOMAIN <- apply(all_pY_sites,1, function(x){ Return_DOMAIN(x[1], x[3] )}  )
all_pY_sites$MOD_RSD <- apply(all_pY_sites,1, function(x){ Return_MOD_RSD(x[1], x[3] )}  )
all_pY_sites$SITE_GRP_ID <- as.double( apply(all_pY_sites,1, function(x){ Return_SITE_GRP_ID(x[1], x[3] )}  ) )

all_pY_sites <- left_join(all_pY_sites,
          kinase_substrate_dataset %>% select(GENE, KINASE, SUBSTRATE, SUB_GENE, SUB_MOD_RSD, SITE_GRP_ID),
          by= "SITE_GRP_ID")

all_pY_sites <- left_join(all_pY_sites, 
          Regulatory_sites_dataset %>% filter(GENE %in% unique(all_pY_sites$HGNC_Symbol), str_detect(MOD_RSD, "Y") ) , 
          by = c( "HGNC_Symbol" = "GENE", "MOD_RSD" )) 
```



#### pST
##### Old
```{r, eval=FALSE}
# TODO How to deal with peptides which have multiple phosphorylations?

all_pST_sites <- bind_rows(
  pST_Set1_form %>% select(HGNC_Symbol, Annotated_Sequence),
  pST_Set2_form %>% select(HGNC_Symbol, Annotated_Sequence),
  pST_Set3_form %>% select(HGNC_Symbol, Annotated_Sequence),
  pST_Set4_form %>% select(HGNC_Symbol, Annotated_Sequence),
  pST_Set5_normXenograft1_form %>% select(HGNC_Symbol, Annotated_Sequence)) %>% unique
if(!all(str_count(all_pST_sites$Annotated_Sequence, "s|t") == 1)){warning("There are peptides with multiple pST sites")}
tmp_sequence <- paste0("jjjjjjj", all_pST_sites$Annotated_Sequence,"jjjjjjj" )
position_pST_phos <- str_locate(tmp_sequence, "s|t")[,1]
tmp_sequence <- str_sub(tmp_sequence, (position_pST_phos-7), position_pST_phos + 7)
tmp_sequence <- paste0( str_to_upper(str_sub(tmp_sequence,1,7 )), 
                                  str_to_lower(str_sub(tmp_sequence,8,8 )),
                                  str_to_upper(str_sub(tmp_sequence,9,15 )))
tmp_sequence <- str_replace_all(string = tmp_sequence, pattern ="J", replacement = "")
all_pST_sites$Modified_Sequence <- tmp_sequence
Phosphorylation_site_dataset_pST <- 
  Phosphorylation_site_dataset %>% filter(GENE %in% all_pST_sites$HGNC_Symbol) %>%
  filter(!str_detect(PROTEIN, "iso")) %>%
  filter( str_detect( `SITE_+/-7_AA`, "y|t" ) ) %>% 
  mutate(Modified_Sequence = paste0( str_to_upper(str_sub(`SITE_+/-7_AA`,1,7 )), 
                                  str_to_lower(str_sub(`SITE_+/-7_AA`,8,8 )),
                                  str_to_upper(str_sub(`SITE_+/-7_AA`,9,16 ))) ) %>% 
  select(GENE, PROTEIN, HU_CHR_LOC, MOD_RSD, SITE_GRP_ID, DOMAIN, Modified_Sequence) %>%
  unique()

Return_MOD_RSD <- function(HGNC_Symbol, Modified_Sequence){
  selprot <- Phosphorylation_site_dataset_pST %>% filter(GENE == HGNC_Symbol)
  if(length(str_which(selprot$Modified_Sequence, Modified_Sequence))==1){
  selsite <- selprot[ str_which(selprot$Modified_Sequence, Modified_Sequence), ]
  return(selsite$MOD_RSD)}else{return("NA")}
}

Return_DOMAIN <- function(HGNC_Symbol, Modified_Sequence){
  selprot <- Phosphorylation_site_dataset_pST %>% filter(GENE == HGNC_Symbol)
  if(length(str_which(selprot$Modified_Sequence, Modified_Sequence))==1){
  selsite <- selprot[ str_which(selprot$Modified_Sequence, Modified_Sequence), ]
  return(selsite$DOMAIN)}else{return("NA")}
}

Return_SITE_GRP_ID <- function(HGNC_Symbol, Modified_Sequence){
  selprot <- Phosphorylation_site_dataset_pST %>% filter(GENE == HGNC_Symbol)
  if(length(str_which(selprot$Modified_Sequence, Modified_Sequence))==1){
  selsite <- selprot[ str_which(selprot$Modified_Sequence, Modified_Sequence), ]
  return(selsite$SITE_GRP_ID)}else{return("NA")}
}

all_pST_sites$DOMAIN <- apply(all_pST_sites,1, function(x){ Return_DOMAIN(x[1], x[3] )}  )
all_pST_sites$MOD_RSD <- apply(all_pST_sites,1, function(x){ Return_MOD_RSD(x[1], x[3] )}  )
all_pST_sites$SITE_GRP_ID <- as.double( apply(all_pST_sites,1, function(x){ Return_SITE_GRP_ID(x[1], x[3] )}  ) )

all_pST_sites <- left_join(all_pST_sites,
          kinase_substrate_dataset %>% select(GENE, KINASE, SUBSTRATE, SUB_GENE, SUB_MOD_RSD, SITE_GRP_ID),
          by= "SITE_GRP_ID")

all_pST_sites <- left_join(all_pST_sites, 
          Regulatory_sites_dataset %>% filter(GENE %in% unique(all_pST_sites$HGNC_Symbol), str_detect(MOD_RSD, "S|T") ) , 
          by = c( "HGNC_Symbol" = "GENE", "MOD_RSD" )) 
```

##### For motif
```{r, eval=TRUE}
all_pST_sites <- bind_rows(
  pST_Set1 %>% select(Sequence, `Annotated Sequence`, HGNC_Symbol, `Master Protein Accessions`),
  pST_Set2 %>% select(Sequence, `Annotated Sequence`, HGNC_Symbol, `Master Protein Accessions`),
  pST_Set3 %>% select(Sequence, `Annotated Sequence`, HGNC_Symbol, `Master Protein Accessions`),
  pST_Set4 %>% select(Sequence, `Annotated Sequence`, HGNC_Symbol, `Master Protein Accessions`),
  pST_Set5_normXenograft1 %>% select(Sequence, `Annotated Sequence`, HGNC_Symbol, `Master Protein Accessions`)) %>% unique
if(!all(str_count(all_pST_sites$`Annotated Sequence`, "s|t") == 1)){warning("There are peptides with multiple pST sites")}

table(all_pST_sites$`Master Protein Accessions` %in% Phosphorylation_site_dataset$ACC_ID )

Phosphorylation_site_dataset_pST <- Phosphorylation_site_dataset %>% filter(ACC_ID %in% all_pST_sites$`Master Protein Accessions`)

# TODO: s/t in first place might have TMT and or phos
# TODO did not account for double phosphorylated peptides
extracted_trimmed_peptide <- function(peptide){
  str_extract(peptide, "s|t")
  
  if( nchar( sub("[ts].*", "", peptide )) >= 7 & 
      nchar( sub(".*[ts]", "", peptide )) >= 7){
    pep_trimmed <- str_extract(peptide, ".......[ts].......")
  }else if(nchar( sub("[ts].*", "", peptide )) < 7 &
           nchar( sub(".*[ts]", "", peptide )) < 7){
    pep_trimmed <- str_extract(peptide, ".*[ts].*")
  }else if(nchar( sub("[ts].*", "", peptide )) < 7){
    pep_trimmed <- str_extract(peptide, ".*[ts].......")
  }else if(nchar( sub(".*[ts]", "", peptide )) < 7){
    pep_trimmed <- str_extract(peptide, ".......[ts].*")
  }else{stop(paste("Could not extract trimmed sequence from", peptide )) }
  return(pep_trimmed)
}

all_pST_sites$trimmed_sequence <- sapply(all_pST_sites$`Annotated Sequence`, extracted_trimmed_peptide, simplify = T)
 
#peptide <- all_pST_sites$trimmed_sequence[315] 
#protein <- all_pST_sites$`Master Protein Accessions`[315] 

get_plusminus_7AA_sequence <- function(peptide, protein){
  mod_peptide <- paste0(str_to_upper(sub("[ts].*", "", peptide) ),
         str_extract(peptide, "[ts]"),
         str_to_upper(sub(".*[ts]", "", peptide) ) )
  sequ <- Phosphorylation_site_dataset_pST %>% filter(ACC_ID == protein) %>%
    mutate( SEQUENCE = paste0(str_to_upper(str_sub(`SITE_+/-7_AA`, 1, 7)),
                               str_sub(`SITE_+/-7_AA`, 8,8),
                              paste0(str_to_upper(str_sub(`SITE_+/-7_AA`, 9, 15)))) ) %>% 
    filter(str_detect(SEQUENCE, mod_peptide)) %>% .$SEQUENCE
  if(length(sequ) == 0){
    return(NA)}else{return(sequ)}
}

sequences7AA <- sapply(1:nrow(all_pST_sites), function(i){
  sequ <- get_plusminus_7AA_sequence(peptide = all_pST_sites$trimmed_sequence[i],
                             protein = all_pST_sites$`Master Protein Accessions`[i]) %>% unique
  if(length(sequ) != 1){
    return(NA)}else{return(sequ)}
  }, simplify = T) 

table(is.na(sequences7AA) )

all_pST_sites$Sequence_7_AA <- sequences7AA

colnames(all_pST_sites)[colnames(all_pST_sites) == "Annotated Sequence"] <- "Annotated_Sequence"

Phosphorylation_site_dataset_pST <- 
  Phosphorylation_site_dataset %>% filter(GENE %in% all_pST_sites$HGNC_Symbol) %>%
  filter(!str_detect(PROTEIN, "iso")) %>%
  filter( str_detect( `SITE_+/-7_AA`, "y|t" ) ) %>% 
  mutate(Modified_Sequence = paste0( str_to_upper(str_sub(`SITE_+/-7_AA`,1,7 )), 
                                  str_to_lower(str_sub(`SITE_+/-7_AA`,8,8 )),
                                  str_to_upper(str_sub(`SITE_+/-7_AA`,9,16 ))) ) %>% 
  select(GENE, PROTEIN, HU_CHR_LOC, MOD_RSD, SITE_GRP_ID, DOMAIN, Modified_Sequence) %>%
  unique()

Return_MOD_RSD <- function(HGNC_Symbol, Modified_Sequence){
  selprot <- Phosphorylation_site_dataset_pST %>% filter(GENE == HGNC_Symbol)
  if(length(str_which(selprot$Modified_Sequence, Modified_Sequence))==1){
  selsite <- selprot[ str_which(selprot$Modified_Sequence, Modified_Sequence), ]
  return(selsite$MOD_RSD)}else{return("NA")}
}

Return_SITE_GRP_ID <- function(HGNC_Symbol, Modified_Sequence){
  selprot <- Phosphorylation_site_dataset_pST %>% filter(GENE == HGNC_Symbol)
  if(length(str_which(selprot$Modified_Sequence, Modified_Sequence))==1){
  selsite <- selprot[ str_which(selprot$Modified_Sequence, Modified_Sequence), ]
  return(selsite$SITE_GRP_ID)}else{return("NA")}
}

all_pST_sites$MOD_RSD <- str_remove( apply(all_pST_sites, 1, function(x){ Return_MOD_RSD(HGNC_Symbol = x[3], Modified_Sequence = x[6] )}  ) , "-p")

all_pST_sites$SITE_GRP_ID <- as.double( apply(all_pST_sites,1, function(x){ Return_SITE_GRP_ID(HGNC_Symbol = x[3], Modified_Sequence = x[6] )}  ) )
```




### Matrix
#### pY
##### Xenograft #1
```{r}
pY_Xenograft1_mat <- pY_Xenograft1_noNA %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()

colnames(pY_Xenograft1_mat) <- paste0( pY_Xenograft1_noNA$HGNC_Symbol, "_", pY_Xenograft1_noNA$Annotated_Sequence )

pY_Xenograft1_mat[1:5, 1:5]
```

##### Xenograft #14
```{r}
pY_Xenograft14_mat <- pY_Xenograft14_noNA %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()

colnames(pY_Xenograft14_mat) <- paste0( pY_Xenograft14_noNA$HGNC_Symbol, "_", pY_Xenograft14_noNA$Annotated_Sequence )

pY_Xenograft14_mat[1:5, ]
```


##### Individual Sets
```{r}
### Set 1
pY_mat_Set1 <- pY_Set1_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pY_mat_Set1) <- paste0( pY_Set1_form$HGNC_Symbol, "_", pY_Set1_form$Annotated_Sequence )
pY_mat_Set1[1:5, 1:5]

#### Set 2
#pY_mat_Set2 <- pY_Set2_form %>% 
#  select(-HGNC_Symbol, -Annotated_Sequence,           
#         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
#  as.matrix() %>% 
#  t()
#colnames(pY_mat_Set2) <- paste0( pY_Set2_form$HGNC_Symbol, "_", #pY_Set2_form$Annotated_Sequence )
#pY_mat_Set2[1:5, 1:5]

### Set 3
pY_mat_Set3 <- pY_Set3_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pY_mat_Set3) <- paste0( pY_Set3_form$HGNC_Symbol, "_", pY_Set3_form$Annotated_Sequence )
pY_mat_Set3[1:5, 1:5]

### Set 4
pY_mat_Set4 <- pY_Set4_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pY_mat_Set4) <- paste0( pY_Set4_form$HGNC_Symbol, "_", pY_Set4_form$Annotated_Sequence )
pY_mat_Set4[1:5, 1:5]

### Set 5
pY_mat_Set5_normXenograft1 <- pY_Set5_normXenograft1_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pY_mat_Set5_normXenograft1) <- paste0( pY_Set5_normXenograft1_form$HGNC_Symbol, "_", pY_Set5_normXenograft1_form$Annotated_Sequence )
pY_mat_Set5_normXenograft1[1:5, 1:5]

### Set 5
pY_mat_Set5_normXenograft14 <- pY_Set5_normXenograft14_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pY_mat_Set5_normXenograft14) <- paste0( pY_Set5_normXenograft14_form$HGNC_Symbol, "_", pY_Set5_normXenograft14_form$Annotated_Sequence )
pY_mat_Set5_normXenograft14[1:5, 1:5]
```

#### pST
##### Xenograft #1
```{r}
pST_Xenograft1_mat <- pST_Xenograft1_noNA %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()

colnames(pST_Xenograft1_mat) <- paste0( pST_Xenograft1_noNA$HGNC_Symbol, "_", pST_Xenograft1_noNA$Annotated_Sequence )

pST_Xenograft1_mat[1:5, 1:5]
```

##### Individual Sets
```{r}
### Set 1
pST_mat_Set1 <- pST_Set1_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pST_mat_Set1) <- paste0( pST_Set1_form$HGNC_Symbol, "_", pST_Set1_form$Annotated_Sequence )
pST_mat_Set1[1:5, 1:5]

### Set 2
pST_mat_Set2 <- pST_Set2_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pST_mat_Set2) <- paste0( pST_Set2_form$HGNC_Symbol, "_", pST_Set2_form$Annotated_Sequence )
pST_mat_Set2[1:5, 1:5]

### Set 3
pST_mat_Set3 <- pST_Set3_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pST_mat_Set3) <- paste0( pST_Set3_form$HGNC_Symbol, "_", pST_Set3_form$Annotated_Sequence )
pST_mat_Set3[1:5, 1:5]

### Set 4
pST_mat_Set4 <- pST_Set4_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pST_mat_Set4) <- paste0( pST_Set4_form$HGNC_Symbol, "_", pST_Set4_form$Annotated_Sequence )
pST_mat_Set4[1:5, 1:5]

### Set 5
pST_mat_Set5_normXenograft1 <- pST_Set5_normXenograft1_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pST_mat_Set5_normXenograft1) <- paste0( pST_Set5_normXenograft1_form$HGNC_Symbol, "_", pST_Set5_normXenograft1_form$Annotated_Sequence )
pST_mat_Set5_normXenograft1[1:5, 1:5]

### Set 5
pST_mat_Set5_normXenograft14 <- pST_Set5_normXenograft14_form %>% 
  select(-HGNC_Symbol, -Annotated_Sequence,           
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix() %>% 
  t()
colnames(pST_mat_Set5_normXenograft14) <- paste0( pST_Set5_normXenograft14_form$HGNC_Symbol, "_", pST_Set5_normXenograft14_form$Annotated_Sequence )
pST_mat_Set5_normXenograft14[1:5, 1:5]
```



### Summarised Experiment
#### pY
##### Combined
###### Xenograft #1
```{r}
# Assay data
assay_data_pY_Xenograft1 <- 
  pY_Xenograft1_noNA %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pY_Xenograft1) <- gsub("log2FC_Xenograft1_", "", colnames(assay_data_pY_Xenograft1) )

# RowData
rowData_pY_Xenograft1 <- 
  pY_Xenograft1_noNA %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pY_Xenograft1 <- 
  str_split( #gsub("log2FC_Xenograft1_", "", 
                  colnames(assay_data_pY_Xenograft1 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pY_Xenograft1) <- #gsub("log2FC_Xenograft_", "", 
                                        colnames(assay_data_pY_Xenograft1)
                                    #    )
colnames(colData_pY_Xenograft1) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pY_Xenograft1$label <- #gsub("log2FC_Xenograft_", "", 
                                    colnames(assay_data_pY_Xenograft1) # )
colData_pY_Xenograft1$ID <- #gsub("log2FC_Xenograft_", "", 
                                 colnames(assay_data_pY_Xenograft1) #)

pY_Xenograft1_se <- SummarizedExperiment(assays = assay_data_pY_Xenograft1,
                           colData = colData_pY_Xenograft1,
                           rowData = rowData_pY_Xenograft1)
validObject(pY_Xenograft1_se)
pY_Xenograft1_se
```

###### Xenograft #14
```{r}
# Assay data
assay_data_pY_Xenograft14 <- 
  pY_Xenograft14_noNA %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pY_Xenograft14) <- gsub("log2FC_Xenograft14_", "", colnames(assay_data_pY_Xenograft14) )

# RowData
rowData_pY_Xenograft14 <- 
  pY_Xenograft14_noNA %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pY_Xenograft14 <- 
  str_split( #gsub("log2FC_Xenograft14_", "", 
                  colnames(assay_data_pY_Xenograft14 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pY_Xenograft14) <- #gsub("log2FC_Xenograft_", "", 
                                        colnames(assay_data_pY_Xenograft14)
                                    #    )
colnames(colData_pY_Xenograft14) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pY_Xenograft14$label <- #gsub("log2FC_Xenograft_", "", 
                                    colnames(assay_data_pY_Xenograft14) # )
colData_pY_Xenograft14$ID <- #gsub("log2FC_Xenograft_", "", 
                                 colnames(assay_data_pY_Xenograft14) #)

pY_Xenograft14_se <- SummarizedExperiment(assays = assay_data_pY_Xenograft14,
                           colData = colData_pY_Xenograft14,
                           rowData = rowData_pY_Xenograft14)
validObject(pY_Xenograft14_se)
pY_Xenograft14_se
```


##### Individual sets
###### Set 1
```{r}
# Assay data
assay_data_pY_Set1 <- 
  pY_Set1_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pY_Set1) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pY_Set1) )

# RowData
rowData_pY_Set1 <- 
  pY_Set1_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pY_Set1 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pY_Set1 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pY_Set1) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pY_Set1) #)
colnames(colData_pY_Set1) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pY_Set1$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pY_Set1) #)
colData_pY_Set1$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pY_Set1) #)

pY_se_Set1 <- SummarizedExperiment(assays = assay_data_pY_Set1,
                           colData = colData_pY_Set1,
                           rowData = rowData_pY_Set1)
validObject(pY_se_Set1)
pY_se_Set1
```

###### Set 3
```{r}
# Assay data
assay_data_pY_Set3 <- 
  pY_Set3_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pY_Set3) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pY_Set3) )

# RowData
rowData_pY_Set3 <- 
  pY_Set3_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pY_Set3 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pY_Set3 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pY_Set3) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pY_Set3) #)
colnames(colData_pY_Set3) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pY_Set3$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pY_Set3) #)
colData_pY_Set3$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pY_Set3) #)

pY_se_Set3 <- SummarizedExperiment(assays = assay_data_pY_Set3,
                           colData = colData_pY_Set3,
                           rowData = rowData_pY_Set3)
validObject(pY_se_Set3)
pY_se_Set3
```


###### Set 4
```{r}
# Assay data
assay_data_pY_Set4 <- 
  pY_Set4_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pY_Set4) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pY_Set4) )

# RowData
rowData_pY_Set4 <- 
  pY_Set4_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pY_Set4 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pY_Set4 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pY_Set4) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pY_Set4) #)
colnames(colData_pY_Set4) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pY_Set4$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pY_Set4) #)
colData_pY_Set4$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pY_Set4) #)

pY_se_Set4 <- SummarizedExperiment(assays = assay_data_pY_Set4,
                           colData = colData_pY_Set4,
                           rowData = rowData_pY_Set4)
validObject(pY_se_Set4)
pY_se_Set4
```

###### Set 5 norm to Xenograft #1
```{r}
# Assay data
assay_data_pY_Set5_normXenograft1 <- 
  pY_Set5_normXenograft1_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pY_Set5_normXenograft1) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pY_Set5_normXenograft1) )

# RowData
rowData_pY_Set5_normXenograft1 <- 
  pY_Set5_normXenograft1_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pY_Set5_normXenograft1 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pY_Set5_normXenograft1 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pY_Set5_normXenograft1) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pY_Set5_normXenograft1) #)
colnames(colData_pY_Set5_normXenograft1) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pY_Set5_normXenograft1$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pY_Set5_normXenograft1) #)
colData_pY_Set5_normXenograft1$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pY_Set5_normXenograft1) #)

pY_se_Set5_normXenograft1 <- SummarizedExperiment(assays = assay_data_pY_Set5_normXenograft1,
                           colData = colData_pY_Set5_normXenograft1,
                           rowData = rowData_pY_Set5_normXenograft1)
validObject(pY_se_Set5_normXenograft1)
pY_se_Set5_normXenograft1
```

###### Set 5 norm to Xenograft #14
```{r}
# Assay data
assay_data_pY_Set5_normXenograft14 <- 
  pY_Set5_normXenograft14_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pY_Set5_normXenograft14) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pY_Set5_normXenograft14) )

# RowData
rowData_pY_Set5_normXenograft14 <- 
  pY_Set5_normXenograft14_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pY_Set5_normXenograft14 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pY_Set5_normXenograft14 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pY_Set5_normXenograft14) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pY_Set5_normXenograft14) #)
colnames(colData_pY_Set5_normXenograft14) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pY_Set5_normXenograft14$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pY_Set5_normXenograft14) #)
colData_pY_Set5_normXenograft14$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pY_Set5_normXenograft14) #)

pY_se_Set5_normXenograft14 <- SummarizedExperiment(assays = assay_data_pY_Set5_normXenograft14,
                           colData = colData_pY_Set5_normXenograft14,
                           rowData = rowData_pY_Set5_normXenograft14)
validObject(pY_se_Set5_normXenograft14)
pY_se_Set5_normXenograft14
```


#### pST
##### Combined
###### Xenograft #1
```{r}
# Assay data
assay_data_pST_Xenograft1 <- 
  pST_Xenograft1_noNA %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pST_Xenograft1) <- gsub("log2FC_Xenograft1_", "", colnames(assay_data_pST_Xenograft1) )

# RowData
rowData_pST_Xenograft1 <- 
  pST_Xenograft1_noNA %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pST_Xenograft1 <- 
  str_split( #gsub("log2FC_Xenograft1_", "", 
                  colnames(assay_data_pST_Xenograft1 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pST_Xenograft1) <- #gsub("log2FC_Xenograft_", "", 
                                        colnames(assay_data_pST_Xenograft1)
                                    #    )
colnames(colData_pST_Xenograft1) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pST_Xenograft1$label <- #gsub("log2FC_Xenograft_", "", 
                                    colnames(assay_data_pST_Xenograft1) # )
colData_pST_Xenograft1$ID <- #gsub("log2FC_Xenograft_", "", 
                                 colnames(assay_data_pST_Xenograft1) #)

pST_Xenograft1_se <- SummarizedExperiment(assays = assay_data_pST_Xenograft1,
                           colData = colData_pST_Xenograft1,
                           rowData = rowData_pST_Xenograft1)
validObject(pST_Xenograft1_se)
pST_Xenograft1_se
```

###### Xenograft #14
```{r}
# Assay data
assay_data_pST_Xenograft14 <- 
  pST_Xenograft14_noNA %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pST_Xenograft14) <- gsub("log2FC_Xenograft14_", "", colnames(assay_data_pST_Xenograft14) )

# RowData
rowData_pST_Xenograft14 <- 
  pST_Xenograft14_noNA %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pST_Xenograft14 <- 
  str_split( #gsub("log2FC_Xenograft14_", "", 
                  colnames(assay_data_pST_Xenograft14 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pST_Xenograft14) <- #gsub("log2FC_Xenograft_", "", 
                                        colnames(assay_data_pST_Xenograft14)
                                    #    )
colnames(colData_pST_Xenograft14) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pST_Xenograft14$label <- #gsub("log2FC_Xenograft_", "", 
                                    colnames(assay_data_pST_Xenograft14) # )
colData_pST_Xenograft14$ID <- #gsub("log2FC_Xenograft_", "", 
                                 colnames(assay_data_pST_Xenograft14) #)

pST_Xenograft14_se <- SummarizedExperiment(assays = assay_data_pST_Xenograft14,
                           colData = colData_pST_Xenograft14,
                           rowData = rowData_pST_Xenograft14)
validObject(pST_Xenograft14_se)
pST_Xenograft14_se
```


##### Individual sets
###### Set 1
```{r}
# Assay data
assay_data_pST_Set1 <- 
  pST_Set1_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pST_Set1) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pST_Set1) )

# RowData
rowData_pST_Set1 <- 
  pST_Set1_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pST_Set1 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pST_Set1 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pST_Set1) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pST_Set1) #)
colnames(colData_pST_Set1) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pST_Set1$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pST_Set1) #)
colData_pST_Set1$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pST_Set1) #)

pST_se_Set1 <- SummarizedExperiment(assays = assay_data_pST_Set1,
                           colData = colData_pST_Set1,
                           rowData = rowData_pST_Set1)
validObject(pST_se_Set1)
pST_se_Set1
```

###### Set 2
```{r}
# Assay data
assay_data_pST_Set2 <- 
  pST_Set2_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pST_Set2) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pST_Set2) )

# RowData
rowData_pST_Set2 <- 
  pST_Set2_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pST_Set2 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pST_Set2 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pST_Set2) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pST_Set2) #)
colnames(colData_pST_Set2) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pST_Set2$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pST_Set2) #)
colData_pST_Set2$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pST_Set2) #)

pST_se_Set2 <- SummarizedExperiment(assays = assay_data_pST_Set2,
                           colData = colData_pST_Set2,
                           rowData = rowData_pST_Set2)
validObject(pST_se_Set2)
pST_se_Set2
```


###### Set 3
```{r}
# Assay data
assay_data_pST_Set3 <- 
  pST_Set3_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pST_Set3) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pST_Set3) )

# RowData
rowData_pST_Set3 <- 
  pST_Set3_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pST_Set3 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pST_Set3 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pST_Set3) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pST_Set3) #)
colnames(colData_pST_Set3) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pST_Set3$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pST_Set3) #)
colData_pST_Set3$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pST_Set3) #)

pST_se_Set3 <- SummarizedExperiment(assays = assay_data_pST_Set3,
                           colData = colData_pST_Set3,
                           rowData = rowData_pST_Set3)
validObject(pST_se_Set3)
pST_se_Set3
```


###### Set 4
```{r}
# Assay data
assay_data_pST_Set4 <- 
  pST_Set4_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pST_Set4) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pST_Set4) )

# RowData
rowData_pST_Set4 <- 
  pST_Set4_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pST_Set4 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pST_Set4 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pST_Set4) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pST_Set4) #)
colnames(colData_pST_Set4) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pST_Set4$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pST_Set4) #)
colData_pST_Set4$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pST_Set4) #)

pST_se_Set4 <- SummarizedExperiment(assays = assay_data_pST_Set4,
                           colData = colData_pST_Set4,
                           rowData = rowData_pST_Set4)
validObject(pST_se_Set4)
pST_se_Set4
```

###### Set 5 norm to Xenograft #1
```{r}
# Assay data
assay_data_pST_Set5_normXenograft1 <- 
  pST_Set5_normXenograft1_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pST_Set5_normXenograft1) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pST_Set5_normXenograft1) )

# RowData
rowData_pST_Set5_normXenograft1 <- 
  pST_Set5_normXenograft1_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pST_Set5_normXenograft1 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pST_Set5_normXenograft1 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pST_Set5_normXenograft1) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pST_Set5_normXenograft1) #)
colnames(colData_pST_Set5_normXenograft1) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pST_Set5_normXenograft1$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pST_Set5_normXenograft1) #)
colData_pST_Set5_normXenograft1$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pST_Set5_normXenograft1) #)

pST_se_Set5_normXenograft1 <- SummarizedExperiment(assays = assay_data_pST_Set5_normXenograft1,
                           colData = colData_pST_Set5_normXenograft1,
                           rowData = rowData_pST_Set5_normXenograft1)
validObject(pST_se_Set5_normXenograft1)
pST_se_Set5_normXenograft1
```

###### Set 5 norm to Xenograft #14
```{r}
# Assay data
assay_data_pST_Set5_normXenograft14 <- 
  pST_Set5_normXenograft14_form %>% 
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln") %>%
  select( -Annotated_Sequence, -HGNC_Symbol, 
         -Master.Protein.Descriptions, -Master.Protein.Accessions) %>%
  as.matrix()

#colnames(assay_data_pST_Set5_normXenograft14) <- gsub("log2FC_Xenograft_", "", colnames(assay_data_pST_Set5_normXenograft14) )

# RowData
rowData_pST_Set5_normXenograft14 <- 
  pST_Set5_normXenograft14_form %>%
  select(Annotated_Sequence, HGNC_Symbol, Master.Protein.Descriptions, Master.Protein.Accessions) %>%
  mutate(coln = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  mutate(ID = paste0(HGNC_Symbol, "_", Annotated_Sequence), 
         name = paste0(HGNC_Symbol, "_", Annotated_Sequence)) %>%
  as.data.frame() %>% 
  column_to_rownames("coln")


# ColData
colData_pST_Set5_normXenograft14 <- 
  str_split( 
    #gsub("log2FC_Xenograft_", "", 
         colnames(assay_data_pST_Set5_normXenograft14 #) 
                  ), pattern = "_", simplify = TRUE ) %>%
  as.data.frame()
rownames(colData_pST_Set5_normXenograft14) <- #gsub("log2FC_Xenograft_", "", 
                                  colnames(assay_data_pST_Set5_normXenograft14) #)
colnames(colData_pST_Set5_normXenograft14) <- c( "log2FC", "Xenograft", "condition", "day", "replicate", "set" )
colData_pST_Set5_normXenograft14$label <- #gsub("log2FC_Xenograft_", "", 
                              colnames(assay_data_pST_Set5_normXenograft14) #)
colData_pST_Set5_normXenograft14$ID <- #gsub("log2FC_Xenograft_", "", 
                           colnames(assay_data_pST_Set5_normXenograft14) #)

pST_se_Set5_normXenograft14 <- SummarizedExperiment(assays = assay_data_pST_Set5_normXenograft14,
                           colData = colData_pST_Set5_normXenograft14,
                           rowData = rowData_pST_Set5_normXenograft14)
validObject(pST_se_Set5_normXenograft14)
pST_se_Set5_normXenograft14
```

### Median center
#### pY
##### Combined
```{r}
pY_Xenograft1_mat_normtomedian <- t(log2(t(2^pY_Xenograft1_mat)/colMedians(2^pY_Xenograft1_mat) ))
pY_Xenograft1_mat_normtomedian[1:5,1:5]

pY_Xenograft14_mat_normtomedian <- t(log2(t(2^pY_Xenograft14_mat)/colMedians(2^pY_Xenograft14_mat) ))
pY_Xenograft14_mat_normtomedian[1:5,]
```

##### Individual sets
```{r}
pY_mat_Set1_normtomedian <- t(log2(t(2^pY_mat_Set1)/colMedians(2^pY_mat_Set1) ))
pY_mat_Set1_normtomedian[1:5,1:5]

#pY_mat_Set2_normtomedian <- t(log2(t(2^pY_mat_Set2)/colMedians(2^pY_mat_Set2) ))
#pY_mat_Set2_normtomedian[1:5,1:5]

pY_mat_Set3_normtomedian <- t(log2(t(2^pY_mat_Set3)/colMedians(2^pY_mat_Set3) ))
pY_mat_Set3_normtomedian[1:5,1:5]

pY_mat_Set4_normtomedian <- t(log2(t(2^pY_mat_Set4)/colMedians(2^pY_mat_Set4) ))
pY_mat_Set4_normtomedian[1:5,1:5]

pY_mat_Set5_normXenograft1_normtomedian <- t(log2(t(2^pY_mat_Set5_normXenograft1)/colMedians(2^pY_mat_Set5_normXenograft1) ))
pY_mat_Set5_normXenograft1_normtomedian[1:5,1:5]

pY_mat_Set5_normXenograft14_normtomedian <- t(log2(t(2^pY_mat_Set5_normXenograft14)/colMedians(2^pY_mat_Set5_normXenograft14) ))
pY_mat_Set5_normXenograft14_normtomedian[1:5,1:5]
```



#### pST
##### Combined
```{r}
pST_Xenograft1_mat_normtomedian <- t(log2(t(2^pST_Xenograft1_mat)/colMedians(2^pST_Xenograft1_mat) ))
pST_Xenograft1_mat_normtomedian[1:5,1:5]

#pST_Xenograft14_mat_normtomedian <- t(log2(t(2^pST_Xenograft14_mat)/colMedians(2^pST_Xenograft14_mat) ))
#pST_Xenograft14_mat_normtomedian[1:5,1:5]
```

##### Individual sets
```{r}
pST_mat_Set1_normtomedian <- t(log2(t(2^pST_mat_Set1)/colMedians(2^pST_mat_Set1) ))
pST_mat_Set1_normtomedian[1:5,1:5]

pST_mat_Set2_normtomedian <- t(log2(t(2^pST_mat_Set2)/colMedians(2^pST_mat_Set2) ))
pST_mat_Set2_normtomedian[1:5,1:5]

pST_mat_Set3_normtomedian <- t(log2(t(2^pST_mat_Set3)/colMedians(2^pST_mat_Set3) ))
pST_mat_Set3_normtomedian[1:5,1:5]

pST_mat_Set4_normtomedian <- t(log2(t(2^pST_mat_Set4)/colMedians(2^pST_mat_Set4) ))
pST_mat_Set4_normtomedian[1:5,1:5]

pST_mat_Set5_normXenograft1_normtomedian <- t(log2(t(2^pST_mat_Set5_normXenograft1)/colMedians(2^pST_mat_Set5_normXenograft1) ))
pST_mat_Set5_normXenograft1_normtomedian[1:5,1:5]

pST_mat_Set5_normXenograft14_normtomedian <- t(log2(t(2^pST_mat_Set5_normXenograft14)/colMedians(2^pST_mat_Set5_normXenograft14) ))
pST_mat_Set5_normXenograft14_normtomedian[1:5,1:5]
```

# Save workspace
```{r}
save.image(file = "../Data/Cache/Xenografts_Batch2_DataProcessing.RData")
```

# Session Info
```{r}
sessionInfo()
knitr::knit_exit()
```
